<!doctype html>
<!--
  ============================================================
  ESTUDIANT – Web App (archivo único)
  Contenedor único BEM: .app
  Funciones:
    · Catálogo (MATERIAS/catalog.json) para cargar bancos .json del sitio
    · Importar JSON (archivo/pegado)
    · Exportar/Importar CSV (calificar)
    · Modo repaso/examen con temporizador y bloqueo al finalizar
    · Persistencia (localStorage)
    · Responsive + una sola columna siempre
    · NO sticky
  Recomendado: desplegar en Netlify/Vercel (HTTPS) para uso en iPhone/iPad.
  ============================================================
-->
<html lang="es">
<head>
  <!-- ========== Metadatos ========== -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ESTUDIANT</title>

  <!-- ========== CSS (BEM + responsive + una columna) ========== -->
  <style>
    /* --------------------------------------------------------
       Tema y escala de espacios
       -------------------------------------------------------- */
    :root{
      --bg:#0b1020; --bg2:#0e1530; --card:#121a33;
      --text:#e9efff; --muted:#a9b7db; --border:#22305c;
      --accent:#5dd0ff; --ok:#35d49a; --bad:#ff6b6b; --warn:#ffd166;
      --s-1:8px; --s-2:12px; --s-3:16px; --radius:12px;
    }

    /* --------------------------------------------------------
       Reset mínimo
       -------------------------------------------------------- */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
      color:var(--text); background:linear-gradient(180deg,var(--bg),var(--bg2));
    }

    /* =========================================================
       Bloque único: .app
       ========================================================= */
    .app{max-width:clamp(320px, 96vw, 1040px); margin:28px auto; padding:0 var(--s-3)}
    .app__header{display:flex; align-items:center; justify-content:space-between; gap:var(--s-3); margin-bottom:var(--s-3)}
    .app__title{margin:0 0 6px; font-size:1.6rem; letter-spacing:.02em}
    .app__subtitle{margin:0; color:var(--muted)}
    .app__toolbar{display:flex; flex-wrap:wrap; gap:var(--s-2)}
    .app__stats{color:var(--muted); font-size:.95rem; display:flex; gap:var(--s-2); flex-wrap:wrap; align-items:center; margin-top:var(--s-2)}
    .app__list{margin-top:var(--s-3)}
    .app__footer{margin:22px 0 38px; color:var(--muted); font-size:.9rem}

    /* Botón */
    .app__btn{appearance:none; border:none; border-radius:10px; padding:10px 14px; background:#1a2548; color:var(--text); cursor:pointer; border:1px solid var(--border); transition:transform .05s ease, background .2s ease; min-height:44px}
    .app__btn:hover{background:#1e2b56}
    .app__btn:active{transform:scale(.98)}
    .app__btn[disabled]{opacity:.55; cursor:not-allowed}
    .app__btn--accent{background:#1a364f; border-color:#2b6ca0}
    .app__btn--ok{background:#163b2f; border-color:#1f7a5f}
    .app__btn--warn{background:#3d2f13; border-color:#906d26}
    .app__btn--danger{background:#4a1f1f; border-color:#8a3030}

    /* Píldora */
    .app__pill{padding:.1rem .5rem; border-radius:999px; border:1px solid var(--border); color:var(--muted); font-size:.78rem}

    /* Paneles */
    .app__panel{margin:10px 0 12px}
    .app__panel-summary{cursor:pointer; color:var(--accent)}
    .app__panel-body{border:1px solid var(--border); background:#0f1732; padding:var(--s-3); border-radius:var(--radius); margin-top:var(--s-2); display:grid; gap:var(--s-2)}
    .app__panel-row{display:flex; gap:var(--s-2); align-items:center; flex-wrap:wrap}
    .app__panel-input{padding:10px; border-radius:8px; border:1px solid var(--border); background:#0b132a; color:var(--text)}
    .app__panel-textarea{width:100%; min-height:120px; padding:10px; border-radius:8px; border:1px solid var(--border); background:#0b132a; color:var(--text); resize:vertical; font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace}
    .app__panel-hint{color:var(--muted); font-size:.9rem}

    /* Tarjeta de pregunta (siempre 1 columna) */
    .app__card{background:rgba(18,26,51,.86); border:1px solid var(--border); border-radius:var(--radius); padding:var(--s-3) var(--s-3) var(--s-2); margin:14px 0}
    .app__card--ok{border-left:6px solid var(--ok)}
    .app__card--bad{border-left:6px solid var(--bad)}
    .app__card-head{display:flex; gap:var(--s-2); margin-bottom:var(--s-2)}
    .app__card-tag{font-size:.8rem; color:#9fb0d4; background:#162149; border:1px solid var(--border); padding:2px 8px; border-radius:999px}
    .app__card-title{margin:0; font-size:1.02rem}
    .app__card-options{display:grid; gap:var(--s-2); margin:10px 0 var(--s-2); grid-template-columns:1fr} /* <<<-- AQUI ESTA EL CAMBIO */
    .app__card-option{display:flex; gap:10px; padding:10px 12px; border-radius:10px; border:1px solid var(--border); background:#0f1732}
    .app__card-option input{margin-top:2px; transform:scale(1.15)}
    .app__card-option--correct{outline:2px solid rgba(53,212,154,.7); background:#0f1f1a}
    .app__card-option--wrong{outline:2px solid rgba(255,107,107,.65); background:#281515}
    .app__card-actions{display:flex; gap:var(--s-2); margin-top:var(--s-2)}
    .app__card-hint{font-size:.9rem; color:var(--muted); margin-left:auto}
    .app__card-feedback{margin-top:var(--s-2); font-weight:600}
    .app__card-feedback--ok{color:var(--ok)}
    .app__card-feedback--bad{color:var(--bad)}
    .app__card-feedback--muted{color:var(--muted)}
    .app__card-exp{margin-top:var(--s-2); padding:10px 12px; border:1px dashed var(--border); border-radius:10px; color:var(--muted); background:#0e1630; display:none}

    /* Modificadores de modo */
    .app--exam .app__card-actions{display:none}
    .app--exam .app__card-exp{display:none !important}
    .app--exam #pill-timer{display:inline-block}
    #pill-timer{display:none}
    .app--exam #pill-score{visibility:hidden}
    .app--exam.app--finished #pill-score{visibility:visible}
    .app--exam.app--finished .app__card input[type="radio"]{pointer-events:none}

    /* Breakpoints */
    @media (max-width: 900px){
      .app__header{flex-direction:column; align-items:flex-start}
      .app__toolbar{width:100%; justify-content:flex-start}
    }
    @media (max-width: 720px){
      body{font-size:15px}
      .app{margin:20px auto; padding:0 var(--s-2)}
      .app__header{align-items:center; text-align:center}
      .app__toolbar{justify-content:center}
      .app__btn{flex:1 1 calc(50% - var(--s-2)); min-width:44%}
      .app__stats{justify-content:center}
      .app__panel-row{flex-direction:column; align-items:stretch}
      .app__panel-input, .app__panel-textarea, select{width:100%}
      .app__card-hint{display:none}
    }
    @media (max-width: 420px){
      body{font-size:14px}
      .app__btn{flex:1 1 100%}
      .app__title{font-size:1.4rem}
      .app__panel-body{padding:var(--s-2)}
    }
    @media (prefers-reduced-motion: reduce){
      .app__btn{transition:none}
    }
  </style>
</head>

<body>
  <!-- =========================================================
       CONTENEDOR ÚNICO (Bloque .app)
       ========================================================= -->
  <div class="app" id="app">

    <!-- Header (NO sticky) -->
    <header class="app__header">
      <div>
        <h1 class="app__title">ESTUDIANT</h1>
        <p class="app__subtitle" id="txt-subtitle">
          Catálogo en la nube · Importar JSON/CSV · Modo repaso/examen · Exportar CSV
        </p>
      </div>

      <div class="app__toolbar">
        <button id="btn-shuffle"    class="app__btn app__btn--accent">Mezclar</button>
        <button id="btn-check-all"  class="app__btn app__btn--ok">Corregir todo</button>
        <button id="btn-reset"      class="app__btn app__btn--warn">Reiniciar</button>
        <button id="btn-export"     class="app__btn app__btn--ok">Exportar CSV</button>
        <input  id="file-csv" type="file" accept=".csv,text/csv" style="display:none" />
        <button id="btn-import-csv" class="app__btn app__btn--accent">Importar CSV</button>
        <button id="btn-swap-label" class="app__btn app__btn--accent">Intercambiar etiquetas</button>
        <button id="btn-clear"      class="app__btn app__btn--danger">Borrar datos</button>
      </div>
    </header>

    <!-- Panel: Importar JSON -->
    <details class="app__panel" id="panel-import">
      <summary class="app__panel-summary">Cargar preguntas (JSON)</summary>
      <div class="app__panel-body">
        <div class="app__panel-row">
          <input id="file-json" type="file" accept="application/json" class="app__panel-input" />
          <button id="btn-load-file" class="app__btn app__btn--accent">Cargar archivo JSON</button>
          <span class="app__panel-hint">Recomendado para uso offline (PC/Mac).</span>
        </div>

        <textarea id="txt-json" class="app__panel-textarea" placeholder='[ { "q":"Pregunta...", "opts":["A","B","C","D"], "ans":0, "exp":"..." } ]'></textarea>

        <div class="app__panel-row">
          <button id="btn-load-text" class="app__btn app__btn--ok">Cargar JSON pegado</button>
        </div>
      </div>
    </details>

    <!-- Panel: Catálogo (MATERIAS/catalog.json) -->
    <details class="app__panel" id="panel-catalog">
      <summary class="app__panel-summary">Materias del repositorio</summary>
      <div class="app__panel-body">
        <div class="app__panel-row">
          <select id="catalog-select" class="app__panel-input" aria-label="Selecciona materia"></select>
          <button id="btn-load-catalog"   class="app__btn app__btn--ok">Cargar materia</button>
          <button id="btn-reload-catalog" class="app__btn app__btn--accent" title="Actualizar catálogo">Actualizar catálogo</button>
        </div>
        <div class="app__panel-row">
          <span class="app__panel-hint">
            Se lee <code>MATERIAS/catalog.json</code> desde tu sitio (Netlify/Vercel).
          </span>
        </div>
      </div>
    </details>

    <!-- Panel: Modo repaso/examen -->
    <details class="app__panel" id="panel-mode">
      <summary class="app__panel-summary" id="txt-mode-summary">Modo examen</summary>
      <div class="app__panel-body">
        <div class="app__panel-row">
          <label>
            Duración (min):
            <input id="inp-minutes" type="number" min="1" max="300" value="20" class="app__panel-input" />
          </label>
          <label>
            <input id="chk-shuffle" type="checkbox" checked />
            Mezclar al iniciar
          </label>
          <span class="app__panel-hint" id="txt-mode-hint">Sin feedback hasta “Finalizar”.</span>
        </div>
        <div class="app__panel-row">
          <button id="btn-start"     class="app__btn app__btn--ok">Iniciar examen</button>
          <button id="btn-finish"    class="app__btn app__btn--warn">Finalizar examen</button>
          <button id="btn-resetmode" class="app__btn app__btn--danger">Reiniciar modo examen</button>
        </div>
      </div>
    </details>

    <!-- Panel: Resumen import CSV -->
    <details class="app__panel" id="panel-csv" style="display:none">
      <summary class="app__panel-summary">Resultado de la importación CSV</summary>
      <div class="app__panel-body" id="csv-summary"></div>
    </details>

    <!-- Estado -->
    <div class="app__stats">
      <span id="pill-score"   class="app__pill">Aciertos: 0 / 0</span>
      <span id="pill-timer"   class="app__pill">00:00</span>
      <span id="pill-dataset" class="app__pill">Dataset: por defecto</span>
      <span class="app__pill">Archivo único</span>
    </div>

    <!-- Lista de preguntas -->
    <div id="list" class="app__list"></div>

    <!-- Pie -->
    <footer class="app__footer">
      Para iPhone/iPad, sirve desde Netlify/Vercel y añade a pantalla de inicio. Para PC/Mac, funciona local con doble clic.
    </footer>

  </div> <!-- / .app -->

  <!-- ========== JavaScript (IIFE con comentarios) ========== -->
  <script>
    (function(){
      'use strict';

      /* Polyfills, utilidades y variables de estado (código JS idéntico al de la versión anterior) */
      
      /* ... (pegar aquí todo el bloque JS de la versión anterior) ... */

    })();
  </script>
</body>
</html>
